{{> header }}

    <div class="main_wrapper background_color_gray" style="padding-top:20px;">
        <!-- C O N T E N T -->
        <div class="content_wrapper">
        	<!--<div class="page_title_block">
            	<div class="container">
                    <h2 class="title">Book Details</h2>
                    <div class="breadcrumbs"><a href="home.html">Home</a><a href="#">Pages</a><span>About</span></div>
                </div>
            </div>-->
            <div class="container">
                <div class="spinner"  style='display: none;z-index: 100;opacity:0.55;background-color: grey'>
                    <div class="double-bounce1"></div>
                    <div class="double-bounce2"></div>
                </div>
                <div class="content_block no-sidebar row">
                    <div class="fl-container span12">
                        <div class="row">
                            <div class="posts-block span12">
                                <div class="contentarea">
                                    {{# data}}
                                    <div class="row-fluid">
                                        <div class="span2 module_cont module_text_area">

                                        </div>
										<div class="span3 module_cont module_text_area">
                                        	<img src="{{image}}" alt="" align="middle" onerror="this.src='http://cdn2.justbooksclc.com/title/0.jpg';"/>
                                        </div>
                                        <div class="span6 module_cont module_text_area">
											<h2 style="line-height: 31px;">{{title}}</h2>
											<p><strong>By: </strong><a href="/author_details/{{authorid}}">{{author_name}} </a></p>
                                        	<p>{{title}}</p>

											<div class="row-fluid" id="pad_10px">
												<div class="span6 module_cont module_text_area module_none_padding1">
													<h4>2 Times</h4>
													<h6>Rented Till Now</h6>

												</div><!-- .module_cont -->
												<div class="span6 module_cont module_text_area module_none_padding2">
													<h4>4 Days</h4>
													<h6>Average Reading Time</h6>

												</div><!-- .module_cont -->

											</div><!-- .row-fluid -->
										</div>
										<div class="span6 module_text_area text-center" style="margin-left:6%";>


                                            <a href="#reviews-anchor" class="shortcode_button btn_small btn_type10" id="open-review-box">Rate/Review</a>
                                            <div class="row" id="post-review-box" style="display:none;">
                                                <div class="col-md-12">
                                                    <form >
                                                        <input id="ratings-hidden" name="rating" type="hidden">
                                                        <textarea class="form-control animated" cols="50" id="new-review" name="comment" placeholder="Enter your review here..." rows="5"></textarea>

                                                        <div class="text-right">
                                                            <div class="stars starrr" data-rating="0"></div>
                                                            <a class="btn btn-danger btn-sm" href="#" id="close-review-box" style="display:none; margin-right: 10px;">
                                                                <span class="glyphicon glyphicon-remove"></span>Cancel</a>
                                                            <button class="btn btn-success btn-sm" onclick="giveReview()">Save</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                            <script type="text/javascript">
                                                (function(e){var t,o={className:"autosizejs",append:"",callback:!1,resizeDelay:10},i='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',n=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],s=e(i).data("autosize",!0)[0];s.style.lineHeight="99px","99px"===e(s).css("lineHeight")&&n.push("lineHeight"),s.style.lineHeight="",e.fn.autosize=function(i){return this.length?(i=e.extend({},o,i||{}),s.parentNode!==document.body&&e(document.body).append(s),this.each(function(){function o(){var t,o;"getComputedStyle"in window?(t=window.getComputedStyle(u,null),o=u.getBoundingClientRect().width,e.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(e,i){o-=parseInt(t[i],10)}),s.style.width=o+"px"):s.style.width=Math.max(p.width(),0)+"px"}function a(){var a={};if(t=u,s.className=i.className,d=parseInt(p.css("maxHeight"),10),e.each(n,function(e,t){a[t]=p.css(t)}),e(s).css(a),o(),window.chrome){var r=u.style.width;u.style.width="0px",u.offsetWidth,u.style.width=r}}function r(){var e,n;t!==u?a():o(),s.value=u.value+i.append,s.style.overflowY=u.style.overflowY,n=parseInt(u.style.height,10),s.scrollTop=0,s.scrollTop=9e4,e=s.scrollTop,d&&e>d?(u.style.overflowY="scroll",e=d):(u.style.overflowY="hidden",c>e&&(e=c)),e+=w,n!==e&&(u.style.height=e+"px",f&&i.callback.call(u,u))}function l(){clearTimeout(h),h=setTimeout(function(){var e=p.width();e!==g&&(g=e,r())},parseInt(i.resizeDelay,10))}var d,c,h,u=this,p=e(u),w=0,f=e.isFunction(i.callback),z={height:u.style.height,overflow:u.style.overflow,overflowY:u.style.overflowY,wordWrap:u.style.wordWrap,resize:u.style.resize},g=p.width();p.data("autosize")||(p.data("autosize",!0),("border-box"===p.css("box-sizing")||"border-box"===p.css("-moz-box-sizing")||"border-box"===p.css("-webkit-box-sizing"))&&(w=p.outerHeight()-p.height()),c=Math.max(parseInt(p.css("minHeight"),10)-w||0,p.height()),p.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word",resize:"none"===p.css("resize")||"vertical"===p.css("resize")?"none":"horizontal"}),"onpropertychange"in u?"oninput"in u?p.on("input.autosize keyup.autosize",r):p.on("propertychange.autosize",function(){"value"===event.propertyName&&r()}):p.on("input.autosize",r),i.resizeDelay!==!1&&e(window).on("resize.autosize",l),p.on("autosize.resize",r),p.on("autosize.resizeIncludeStyle",function(){t=null,r()}),p.on("autosize.destroy",function(){t=null,clearTimeout(h),e(window).off("resize",l),p.off("autosize").off(".autosize").css(z).removeData("autosize")}),r())})):this}})(window.jQuery||window.$);

                                                var __slice=[].slice;(function(e,t){var n;n=function(){function t(t,n){var r,i,s,o=this;this.options=e.extend({},this.defaults,n);this.$el=t;s=this.defaults;for(r in s){i=s[r];if(this.$el.data(r)!=null){this.options[r]=this.$el.data(r)}}this.createStars();this.syncRating();this.$el.on("mouseover.starrr","span",function(e){return o.syncRating(o.$el.find("span").index(e.currentTarget)+1)});this.$el.on("mouseout.starrr",function(){return o.syncRating()});this.$el.on("click.starrr","span",function(e){return o.setRating(o.$el.find("span").index(e.currentTarget)+1)});this.$el.on("starrr:change",this.options.change)}t.prototype.defaults={rating:void 0,numStars:5,change:function(e,t){}};t.prototype.createStars=function(){var e,t,n;n=[];for(e=1,t=this.options.numStars;1<=t?e<=t:e>=t;1<=t?e++:e--){n.push(this.$el.append("<span class='glyphicon .glyphicon-star-empty'></span>"))}return n};t.prototype.setRating=function(e){if(this.options.rating===e){e=void 0}this.options.rating=e;this.syncRating();return this.$el.trigger("starrr:change",e)};t.prototype.syncRating=function(e){var t,n,r,i;e||(e=this.options.rating);if(e){for(t=n=0,i=e-1;0<=i?n<=i:n>=i;t=0<=i?++n:--n){this.$el.find("span").eq(t).removeClass("glyphicon-star-empty").addClass("glyphicon-star")}}if(e&&e<5){for(t=r=e;e<=4?r<=4:r>=4;t=e<=4?++r:--r){this.$el.find("span").eq(t).removeClass("glyphicon-star").addClass("glyphicon-star-empty")}}if(!e){return this.$el.find("span").removeClass("glyphicon-star").addClass("glyphicon-star-empty")}};return t}();return e.fn.extend({starrr:function(){var t,r;r=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[];return this.each(function(){var i;i=e(this).data("star-rating");if(!i){e(this).data("star-rating",i=new n(e(this),r))}if(typeof r==="string"){return i[r].apply(i,t)}})}})})(window.jQuery,window);$(function(){return $(".starrr").starrr()})

                                                $(function(){

                                                    $('#new-review').autosize({append: "\n"});

                                                    var reviewBox = $('#post-review-box');
                                                    var newReview = $('#new-review');
                                                    var openReviewBtn = $('#open-review-box');
                                                    var closeReviewBtn = $('#close-review-box');
                                                    var ratingsField = $('#ratings-hidden');

                                                    openReviewBtn.click(function(e)
                                                    {
                                                        reviewBox.slideDown(400, function()
                                                        {
                                                            $('#new-review').trigger('autosize.resize');
                                                            newReview.focus();
                                                        });
                                                        openReviewBtn.fadeOut(100);
                                                        closeReviewBtn.show();
                                                    });

                                                    closeReviewBtn.click(function(e)
                                                    {
                                                        e.preventDefault();
                                                        reviewBox.slideUp(300, function()
                                                        {
                                                            newReview.focus();
                                                            openReviewBtn.fadeIn(200);
                                                        });
                                                        closeReviewBtn.hide();

                                                    });

                                                    $('.starrr').on('starrr:change', function(e, value){
                                                        ratingsField.val(value);
                                                    });
                                                });
                                            </script>


											<a href="javascript:void(0)" class="shortcode_button btn_small btn_type10" onclick='wishlistAdd({{titleid}});'>Add to Wishlist</a>
											<a href="javascript:void(0)" class="shortcode_button btn_small btn_type10" onclick="checkAvailability({{titleid}})">Check Availability</a>

										</div>
                                    </div><!-- .row-fluid -->
                                    <div class="module_line_trigger" data-option="" data-background="#fff url(img/) no-repeat center" data-top-padding="top_padding_normal" data-bottom-padding="module_normal_padding">
                                        <div class="row-fluid">
                                            <div class="span12 module_cont module_bookslider">
                                                <div class="bg_title"><h4 class="headInModule" style="color: #464D52;">RELATED BOOKS</h4></div>
                                                <div class="team_slider">
                                                    <div class="carouselslider teamslider items5" data-count="5">
                                                        <ul class="item_list" id="items5">
                                                            {{# related_books}}
                                                            <li>
                                                                <div class="item item_shadow" id="{{related_book.id}}">
                                                                    <div class="img_block_books"><img src="{{related_book.image}}" alt="Tom" onerror="this.src='http://cdn2.justbooksclc.com/title/0.jpg';"></div>
                                                                    <div class="carousel_body_book">
                                                                        <div class="carousel_title_book">
                                                                            <h5>{{related_book.title}}</h5>
                                                                        </div>
                                                                        <div class="carousel_desc">
                                                                            <div class="smallproflinks">
                                                                                <a href="javascript:void(0)"  title="Wishlist" onclick="wishlistAdd({{related_book.id}});">Wishlist</a>
                                                                                <a href="javascript:void(0)" title="Rent" onclick="placeOrder({{related_book.id}});">Rent</a>
                                                                                <a href="/book_details/{{related_book.id}}"  title="Read" >Read</a>
                                                                                <div class="clear"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                            {{/related_books}}
                                                        </ul>
                                                    </div>
                                                    <div class="clear"></div>
                                                </div><!-- .team_slider -->
                                                <a id="anchor8"></a>
                                            </div>
                                        </div><!-- .row-fluid -->

                                    </div><!-- .module_line_trigger -->

                                    {{/data}}

                                </div><!-- .contentarea -->
                            </div>
                            <div class="left-sidebar-block span3">
                                //Sidebar Text
                            </div><!-- .left-sidebar -->
                        </div>
                        <div class="clear"><!-- ClearFix --></div>
                    </div><!-- .fl-container -->
                    <div class="right-sidebar-block span3">
                        <aside class="sidebar">

                        </aside>
                    </div><!-- .right-sidebar -->
                    <div class="clear"><!-- ClearFix --></div>
                </div>
            </div><!-- .container -->
        </div><!-- .content_wrapper -->

    </div><!-- .main_wrapper -->
    {{> footer}}

<script type="application/javascript">
$(document).ready(function()
{
    $('form').submit(false)
})


        function wishlistAdd(id){
            $(".spinner").show();

        $.ajax({
            type: "GET",
            url: "/updateWishlist?id="+id,
            success: function (data) {
                if (JSON.parse(data) === "failure" ) {
                    toastr.error('Please sign in to update wish list  !');
                }
                else{
                    toastr.success("Successfully updated your wishlist !")
                }
                $(".spinner").hide()
            },
            error:function(err)
            {
                console.log(err);
                toastr.error('Something went wrong  !');
                $(".spinner").hide();

            }

        });
    }

   function checkAvailability(id)
   {
       $(".spinner").show();
       $.ajax({
           type: "GET",
           url: "/checkAvailability?id="+id,
           success: function (data) {
               $(".spinner").hide();

               data=JSON.parse(data);
               console.log(data)
               if(data['success'] === true) {
                   toastr.warning(data['result']['member_cross_reference']['status']);

               }
               if (data['success'] == "failure"){
                   toastr.error('Please sign in to check availability  !');
               }

           },
           error:function(err)
           {
               console.log(err);
               toastr.error('Something went wrong  !');
               $(".spinner").hide();

           }

       });
   }


   function giveReview()
   {
       var title="{{titleid}}";
    var ratings=$("#ratings-hidden").val();
       var review=$("#new-review").val();

       if(ratings === "" || ratings === 0)
    {
        toastr.error('Please give a rating in order to submit  !');
        return false;
    }
       if(review === "" || review === 0)
       {
           toastr.error('Please give a review in order to submit  !');
           return false;
       }
       $(".spinner").show();

       $.ajax({
           type: "POST",
           url: "/submitReview",
           data: {'rate': ratings,'review':review,'title':title},

           success: function (data) {
              console.log(JSON.parse(data));
              $(".spinner").hide();
               if (JSON.parse(data) === "failure" ) {
                   toastr.error('Please sign in to submit a review  !');
               }
               else{
                   toastr.success('Successfully submitted your review, Thank you  !');
               }
               $(".spinner").hide();
               console.log(data);
           },
           error:function(err)
           {
               console.log(err);
               toastr.error('Something went wrong  !');
               $(".spinner").hide();

           }

       });
   }
</script>