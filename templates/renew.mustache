{{> header }}

<div class="main_wrapper background_color_gray" style="padding-top:20px;margin-top: 8%">
    <!-- C O N T E N T -->
    <div class="content_wrapper">
        <!--<div class="page_title_block">
            <div class="container">
                <h2 class="title">Book Details</h2>
                <div class="breadcrumbs"><a href="home.html">Home</a><a href="#">Pages</a><span>About</span></div>
            </div>
        </div>-->
        <div class="container">
            <div class="module_line_trigger" data-option="" data-background="#323232 url(../public/assets/img/) no-repeat center" data-top-padding="top_padding_normal">

                <div class="row-fluid"><a id="anchor2"></a>
                    <div class="span12 module_cont module_price_table">
                        <div class="bg_title bg_title_price" style="text-align: center;">
                            <h4 class="headInModule">MEMBERSHIP PLANS</h4>
                        </div>
                        <div class="price_table_wrapper" id="plansCard">
                            <!--<div class="price_item" style="width:24%">-->
                            <!--<div class="price_item_wrapper">-->
                            <!--<div class="price_item_title"><h5>Starter Kit</h5></div>-->
                            <!--<div class="item_cost_wrapper" style="background-color: #EFAC54;">-->
                            <!--<div class="price_item_title" style="background-color: #EFAC54;"><h4>Rs. 999</h4></div>-->

                            <!--</div>&lt;!&ndash; .item_cost_wrapper &ndash;&gt;-->


                            <!--<div class="price_item_text">3 months plan</div>-->
                            <!--<div class="price_item_text" id="price_item_text">One book at a time</div>-->
                            <!--<div class="price_item_text">No registration fee</div>-->
                            <!--<div class="price_item_text" id="price_item_text">No security deposit</div>-->
                            <!--<div class="price_item_btn" id="btn1"><a href="#">Get It Now !</a></div>-->
                            <!--</div>-->
                            <!--</div>-->
                            <!--<div class="price_item" style="width:24%">-->
                            <!--<div class="price_item_wrapper">-->
                            <!--<div class="price_item_title"><h5>Gold Kit</h5></div>-->
                            <!--<div class="item_cost_wrapper" style="background-color: #347AB6;">-->
                            <!--<div class="price_item_title" style="background-color: #347AB6;"><h4>Rs. 999</h4></div>-->

                            <!--</div>&lt;!&ndash; .item_cost_wrapper &ndash;&gt;-->


                            <!--<div class="price_item_text">Minimum 3 months plan</div>-->
                            <!--<div class="price_item_text" id="price_item_text">Two books at a time</div>-->
                            <!--<div class="price_item_text">One time Registration fee</div>-->
                            <!--<div class="price_item_text" id="price_item_text">One time security deposit</div>-->
                            <!--<div class="price_item_btn" id="btn2"><a href="#">Get It Now !</a></div>-->
                            <!--</div>-->
                            <!--</div>-->
                            <!--<div class="price_item" style="width:24%">-->
                            <!--<div class="price_item_wrapper">-->
                            <!--<div class="price_item_title"><h5>Platinum Kit</h5></div>-->
                            <!--<div class="item_cost_wrapper" style="background-color: #5BB85D;">-->
                            <!--<div class="price_item_title" style="background-color: #5BB85D;"><h4>Rs. 999</h4></div>-->

                            <!--</div>&lt;!&ndash; .item_cost_wrapper &ndash;&gt;-->


                            <!--<div class="price_item_text">Minimum 3 books plan</div>-->
                            <!--<div class="price_item_text" id="price_item_text">Choose number of books</div>-->
                            <!--<div class="price_item_text">One time Registration fee</div>-->
                            <!--<div class="price_item_text" id="price_item_text">One time security deposit</div>-->
                            <!--<div class="price_item_btn" id="btn3"><a href="#">Get It Now !</a></div>-->
                            <!--</div>-->
                            <!--</div>-->

                            <!--<div class="price_item" style="width:24%">-->
                            <!--<div class="price_item_wrapper">-->
                            <!--<div class="price_item_title"><h5>Personal Library Plan</h5></div>-->
                            <!--<div class="item_cost_wrapper" style="background-color: #59C0E1;">-->
                            <!--<div class="price_item_title" style="background-color: #59C0E1;"><h4>Rs. 999</h4></div>-->

                            <!--</div>&lt;!&ndash; .item_cost_wrapper &ndash;&gt;-->


                            <!--<div class="price_item_text">Se up a personal library</div>-->
                            <!--<div class="price_item_text" id="price_item_text">Initial collection of 50 books</div>-->
                            <!--<div class="price_item_text">50% swapping every month </div>-->
                            <!--<div class="price_item_text" id="price_item_text">Additional starter kit gift for free</div>-->
                            <!--<div class="price_item_btn" id="btn4"><a href="#">Get It Now !</a></div>-->
                            <!--</div>-->
                            <!--</div>-->
                            <div class="clear"></div>
                        </div><!-- .price_table_wrapper -->
                    </div><!-- .module_cont -->
                </div><!-- .row-fluid -->
            </div>

        </div><!-- .container -->
    </div><!-- .content_wrapper -->

</div><!-- .main_wrapper -->

{{> footer}}

<script type="application/javascript">
    $(document).ready(function () {
        var email=localStorage.getItem("email");
        var membership=localStorage.getItem("membership");
        $.ajax({
            type: "GET",
            url: "http://staging.justbooksclc.com:8990/api/v1/get_renewal_terms.json?email=ravi@freenet.zone&membercard=M103604",
            success: function (data_new) {
                console.log(data_new);
                var response = '';
                var i = 0;
                var plans = data_new.result;
                var colors = ['#EFAC54','#347AB6','#5BB85D','#59C0E1'];
                plans.forEach(function(arr){
                    response += '<div class="price_item" style="width:20%;padding-bottom: 4%">'+
                            '<div class="price_item_wrapper">'+
                            '<div class="item_cost_wrapper" style="background-color: '+colors[i]+';">'+
                            '<div class="price_item_title" style="background-color: '+colors[i]+';"><h4>'+arr['renewal_month']['term_description']+'</h4></div>'+
                            '</div>'+
                            '<div class="price_item_text">Expires on - '+arr['renewal_month']['expiry_date']+'</div>'+
                            '<div class="price_item_text" id="price_item_text">Renewal Amount - '+arr['renewal_month']['renewal_amount']+' Rs</div>'+
                            '<div class="price_item_btn" id="btn" style="background-color: '+colors[i]+'" onclick="getRenewed('+arr['renewal_month']['signup_months']+','+arr['renewal_month']['delivery_fees']+')"><a href="javascript:void(0)">Get It Now !</a></div>'+
                            '</div></div>';
                    i++;
                    if(i >= colors.length) {
                        i = 0;
                    }
                })

                $('#plansCard').append(response);


            },
            error:function (err) {

                console.log(err);

            }

        });


    });



    function getRenewed(termMonth,fee)

    {
        var email=localStorage.getItem("email");
        var membership=localStorage.getItem("membership");
        console.log("http://staging.justbooksclc.com:8990/api/v1/renewal_payment.json?email="+email+"&membercard="+membership+"&term="+termMonth+"&delivery_option=null&delivery_fees="+fee+"&coupon_code=null&gift_card_no=null&pin=null")
        $.ajax({
            type: "GET",
            dataType: "json",
            url: "http://staging.justbooksclc.com:8990/api/v1/renewal_payment.json?email="+email+"&membercard="+membership+"&term="+termMonth+"&delivery_option=null&delivery_fees="+fee+"&coupon_code=null&gift_card_no=null&pin=null",
            success: function (data_new) {
                console.log(data_new);


                if(data_new.success == true)
                {
                    $.ajax({
                        type: "GET",
                        dataType: "json",
                        url: "http://staging.justbooksclc.com:8990/api/v1/confirm_renewal.json?email="+email+"&membercard="+membership+"&payable_amount="+data_new.result.payable_amount+"&convenience_fee="+data_new.result.convenience_fee+"&renewal_payment_type="+data_new.result.renewal_payment_type+"&plan_id="+data_new.result.plan_id+"&card_number="+data_new.result.card_number+"&member_id="+data_new.result.member_id+"&delivery_fees="+data_new.result.delivery_fees+"&delivery_fees_dormant="+data_new.result.delivery_fees_dormant+"&delivery_option="+data_new.result.delivery_option+"&term="+data_new.result.term+"&member_branch_id="+data_new.result.term+"&member_branch_id="+data_new.result.member_branch_id+"&overdue_adjustment="+data_new.result.overdue_adjustment+"&reward_points="+data_new.result.reward_points+"&gift_card_no="+data_new.result.gift_card_no+"&qc_flag="+data_new.result.qc_flag+"&redeemed_amount="+data_new.result.redeemed_amount+"&pin="+data_new.result.pin+"&coupon_no=null&coupon_id=null&coupon_amount=null",
                        success: function (data) {
                            console.log(data);

                            if(data.success == true)
                            {
                                var orderNumber = data.result.transaction.transaction.order_number;
                                var amount = data.result.transaction.transaction.amount;
console.log(orderNumber);
console.log(amount);
                                saveSession(orderNumber,amount);
                            }



                        },

                    });

                }



            },

        });



    }

    function saveSession(order,amount)
    {
        $.ajax({
            type: "GET",
            url: "/saveSession?orderNumber="+order+"&amount="+amount,
            success: function (data_new) {
                console.log(data_new);
                if(data_new === "success")
                {
                    window.location.href="/PaytmKit/pgRedirect.php";
                    return false;
                }

                window.location.href="/PaytmKit/pgRedirect.php"


            },

        });
    }
</script>
<script>
    $(document).ready(function()
    {
        $('#home').addClass('current-menu-parent');

    })


</script>